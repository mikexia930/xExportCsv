<template>
  <div>
    <div>
      <button @click="handleExport">Export</button>
      <span style="margin-left: 12px">
        <button @click="handleExportImage(false)">Export Image</button>
      </span>
      <span style="margin-left: 12px">
        <button @click="handleExportImage(true)">Export PDF</button>
      </span>
    </div>
    <div id="exportImg" style="padding: 32px; width: 100%; overflow: auto; box-sizing: border-box;">
      <table style="border: 1px solid #c1c1c1; width: 100%; border-collapse: collapse;">
        <tr v-for="rowData in exportData">
          <td
            v-for="field in rowData"
            style="border: 1px solid #c1c1c1; height: 32px; box-sizing: border-box; padding: 0 8px; min-width: 80px"
          >
            {{ field }}
          </td>
        </tr>
      </table>
    </div>
  </div>
</template>

<script setup lang="ts">
import xExportCSVIns from '../packages/XExportCsv/src/index';
import { ref } from 'vue';
import html2canvas from 'html2canvas';
import { jsPDF } from "jspdf";

const exportData = ref([
  ['wqe123312321321231123321231123','1231231231232','1231231231232','1231231231232','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaa','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],
  ['1aaab','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2','2a'],


])
function handleExport() {
  xExportCSVIns.exportCsv('游戏下载', exportData.value).then(() => {
    alert('export successfully')
  }).catch((err) => {
    console.log('err', err)
  });
}

function handleExportImage(isPdf: boolean) {
  const dom = document.getElementById('exportImg');
  console.log('document.getElementById(\'exportImg\')', document.getElementById('exportImg').offsetWidth, dom?.scrollHeight);
  const contentWidth = dom?.scrollWidth;
  const contentHeight = dom?.scrollHeight;
  html2canvas(dom, {
    windowWidth: contentWidth,
    windowHeight: contentHeight,
    dpi: window.devicePixelRatio * 2.5,
  }).then(function(canvas) {
    if (!isPdf) {
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = '游戏下载';
      a.click();
    } else {
      handleExportPDF(canvas,);
    }
    // a.remove();
  });
}

async function handleExportPDF(canvas: any) {
  const pdf = new jsPDF();
  pdf.addImage(canvas, 'JPEG', 0, 0, 210, 297)
  pdf.save('11.pdf')
}
</script>
